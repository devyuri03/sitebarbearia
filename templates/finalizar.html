<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Finalizar Agendamento | Barber Shop</title>
    
    <link rel="stylesheet" href="../static/style.css"> 
    
    <style>
        /* Apenas um CSS b√°sico para ilustrar a sele√ß√£o, se o style.css n√£o carregar */
        .date-button, .time-slot, .payment-card {
            border: 1px solid #ccc;
            padding: 10px;
            cursor: pointer;
            text-align: center;
            border-radius: 5px;
            transition: all 0.2s;
        }
        .date-button.selected, .time-slot.selected, .payment-card.selected {
            background-color: #000;
            color: #fff;
            border-color: #000;
            font-weight: bold;
        }
        .date-selection-grid, .time-selection-grid, .payment-options-grid {
            display: grid;
            gap: 10px;
            grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
            margin-bottom: 20px;
        }
        .container-finalizar {
            max-width: 600px;
            margin: 20px auto;
            padding: 20px;
            border: 1px solid #eee;
            border-radius: 8px;
        }
        .card {
            border: 1px solid #ddd;
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 6px;
        }
        .submit-btn {
            width: 100%;
            padding: 15px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
    </style>
</head>
<body>

    <div class="container-finalizar">
        <h1>üíà Finalizar Agendamento</h1>

        <div class="card service-summary">
            <h3 class="card-title">Servi√ßo Selecionado</h3>
            <div class="service-details-row">
                <div class="service-info">
                    <span class="icon-service">‚úÇÔ∏è</span>
                    <span id="service-name-time">Corte + Barba - 50 min</span> 
                </div>
                <span id="service-price" class="price">R$ 70,00</span>
            </div>
        </div>
        
        <form id="agendamento-form" action="/finalizar" method="POST">

            <input type="hidden" id="servico-hidden" name="servico-nome">
            <input type="hidden" id="data-agendamento-hidden" name="data-agendamento" required>
            <input type="hidden" id="hora-agendamento-hidden" name="hora-agendamento" required>

            <div class="card step-section">
                <h3 class="card-title">üìÖ Escolha a Data e Hor√°rio</h3>
                
                <div class="date-selection-grid">
                    </div>

                <h4 class="time-title">Selecione o Hor√°rio</h4>
                <div class="time-selection-grid">
                    <div class="time-slot" data-time="09:00">09:00</div>
                    <div class="time-slot" data-time="09:30">09:30</div>
                    <div class="time-slot" data-time="10:00">10:00</div>
                    <div class="time-slot" data-time="10:30">10:30</div>
                    <div class="time-slot" data-time="11:00">11:00</div>
                    <div class="time-slot" data-time="11:30">11:30</div>
                    <div class="time-slot" data-time="12:00">12:00</div>
                    <div class="time-slot" data-time="12:30">12:30</div>
                    <div class="time-slot" data-time="14:00">14:00</div>
                    <div class="time-slot" data-time="14:30">14:30</div>
                    <div class="time-slot" data-time="15:00">15:00</div>
                    <div class="time-slot" data-time="15:30">15:30</div>
                    <div class="time-slot" data-time="16:00">16:00</div>
                    <div class="time-slot" data-time="16:30">16:30</div>
                    <div class="time-slot" data-time="17:00">17:00</div>
                    <div class="time-slot" data-time="17:30">17:30</div>
                    <div class="time-slot" data-time="18:00">18:00</div>
                    <div class="time-slot" data-time="18:30">18:30</div>
                    <div class="time-slot" data-time="19:00">19:00</div>
                    <div class="time-slot" data-time="19:30">19:30</div>
                </div>
            </div>

            <div class="card step-section">
                <h3 class="card-title">üí≥ Forma de Pagamento</h3>
                <div class="payment-options-grid">
                    
                    <label for="pagamento-cartao" class="payment-card">
                        <input type="radio" id="pagamento-cartao" name="tipo-pagamento" value="cartao" required>
                        <div class="payment-content">
                            <span class="payment-icon">üí≥</span>
                            <h4>Cart√£o de Cr√©dito/D√©bito</h4>
                            <p>Pague na hora do atendimento</p>
                        </div>
                    </label>
                    
                    <label for="pagamento-pix" class="payment-card">
                        <input type="radio" id="pagamento-pix" name="tipo-pagamento" value="pix">
                        <div class="payment-content">
                            <span class="payment-icon">üì±</span>
                            <h4>PIX</h4>
                            <p>Pagamento instant√¢neo</p>
                        </div>
                    </label>
                    
                    <label for="pagamento-dinheiro" class="payment-card">
                        <input type="radio" id="pagamento-dinheiro" name="tipo-pagamento" value="dinheiro">
                        <div class="payment-content">
                            <span class="payment-icon">üíµ</span>
                            <h4>Dinheiro</h4>
                            <p>Pagar na loja</p>
                        </div>
                    </label>

                </div>
            </div>
            
            <button type="submit" class="submit-btn">CONFIRMAR AGENDAMENTO</button>
            <p class="cancellation-info">Cancelamentos devem ser feitos com at√© 2 horas de anteced√™ncia</p>

        </form>
    </div>

    <script>
        // Mapeamento de servi√ßos para formatar nome, tempo e pre√ßo (adicione mais conforme seus servi√ßos)
        const SERVICES_DATA = {
            'corte-tradicional': { name: 'Corte Tradicional', time: '30 min', price: 'R$ 45,00' },
            'corte-barba': { name: 'Corte + Barba', time: '50 min', price: 'R$ 70,00' },
            'barba-completa': { name: 'Barba Completa', time: '25 min', price: 'R$ 40,00' },
            // ... adicione o restante dos seus servi√ßos
        };

        // Nomes dos dias da semana em portugu√™s
        const DAYS_OF_WEEK = ['Dom', 'Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'S√°b'];

        /**
         * Gera e renderiza os bot√µes de data no grid, pulando os domingos.
         * @param {number} numDays - O n√∫mero de dias √∫teis (n√£o-domingos) a gerar.
         */
        function generateDateButtons(numDays = 7) {
            const dateGrid = document.querySelector('.date-selection-grid');
            dateGrid.innerHTML = ''; // Limpa o conte√∫do existente

            let currentDate = new Date();
            let datesGenerated = 0;

            while (datesGenerated < numDays) {
                const dayOfWeek = currentDate.getDay(); // 0 = Domingo, 1 = Segunda, ..., 6 = S√°bado

                // Pula o domingo (0)
                if (dayOfWeek !== 0) {
                    // Formata√ß√£o para o valor data-date (AAAA-MM-DD)
                    const year = currentDate.getFullYear();
                    const month = String(currentDate.getMonth() + 1).padStart(2, '0'); // M√™s √© 0-indexado
                    const day = String(currentDate.getDate()).padStart(2, '0');
                    const dateString = `${year}-${month}-${day}`;

                    // Cria o bot√£o
                    const button = document.createElement('div');
                    button.classList.add('date-button');
                    button.setAttribute('data-date', dateString);

                    // Adiciona o conte√∫do (Dia da Semana e N√∫mero)
                    button.innerHTML = `
                        <span class="day-of-week">${DAYS_OF_WEEK[dayOfWeek]}</span>
                        <span class="day-number">${currentDate.getDate()}</span>
                    `;

                    dateGrid.appendChild(button);
                    datesGenerated++;
                }

                // Avan√ßa para o pr√≥ximo dia
                currentDate.setDate(currentDate.getDate() + 1);
            }
        }
        
        document.addEventListener('DOMContentLoaded', (event) => {
            const urlParams = new URLSearchParams(window.location.search);
            // Assumindo que voc√™ passa o slug do servi√ßo via URL (ex: /finalizar?servico=corte-barba)
            const servicoParam = urlParams.get('servico'); 
            
            const serviceData = SERVICES_DATA[servicoParam] || { name: 'Servi√ßo Desconhecido', time: '?? min', price: 'R$ 0,00' };
            
            // 1. Preenche a se√ß√£o de resumo do servi√ßo
            document.getElementById('service-name-time').textContent = `${serviceData.name} - ${serviceData.time}`;
            document.getElementById('service-price').textContent = serviceData.price;
            document.getElementById('servico-hidden').value = servicoParam; // Envia o slug

            // 2. Gera e renderiza os bot√µes de data
            // Voc√™ pode alterar o n√∫mero (7) para gerar mais ou menos dias √∫teis
            generateDateButtons(10); 

            // --- L√ìGICA DE INTERA√á√ÉO COM BOT√ïES ---

            // 3. Sele√ß√£o de Data
            const dataHiddenInput = document.getElementById('data-agendamento-hidden');
            let dateButtons = document.querySelectorAll('.date-button'); // Pega os novos bot√µes

            dateButtons.forEach((button, index) => {
                // Seleciona o primeiro bot√£o gerado por padr√£o e preenche o hidden input
                if (index === 0) {
                    button.classList.add('selected');
                    dataHiddenInput.value = button.getAttribute('data-date');
                }

                button.addEventListener('click', () => {
                    // Remove a classe 'selected' de todos os bot√µes de data
                    dateButtons.forEach(btn => btn.classList.remove('selected'));
                    
                    // Adiciona a classe 'selected' ao bot√£o clicado
                    button.classList.add('selected');
                    
                    // Atualiza o input hidden
                    dataHiddenInput.value = button.getAttribute('data-date');
                });
            });
            
            // 4. Sele√ß√£o de Hor√°rio
            const timeSlots = document.querySelectorAll('.time-slot');
            const timeHiddenInput = document.getElementById('hora-agendamento-hidden');

            timeSlots.forEach(slot => {
                slot.addEventListener('click', () => {
                    // Remove a classe 'selected' de todos os slots de hor√°rio
                    timeSlots.forEach(s => s.classList.remove('selected'));
                    
                    // Adiciona a classe 'selected' ao slot clicado
                    slot.classList.add('selected');
                    
                    // Atualiza o input hidden
                    timeHiddenInput.value = slot.getAttribute('data-time');
                });
            });

            // 5. Sele√ß√£o de Pagamento
            const paymentCards = document.querySelectorAll('.payment-card');
            
            paymentCards.forEach(card => {
                card.addEventListener('click', (e) => {
                    // Garante que o clique na label marque o radio e o estilo
                    const radio = card.querySelector('input[type="radio"]');
                    if (radio) {
                        radio.checked = true;
                    }
                    
                    // Remove a classe 'selected' de todos os cart√µes de pagamento
                    paymentCards.forEach(c => c.classList.remove('selected'));
                    
                    // Adiciona a classe 'selected' ao cart√£o clicado (label)
                    card.classList.add('selected');
                });
            });
        });
    </script>
</body>
</html>